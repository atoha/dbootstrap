//>>built
define("dgrid/_StoreMixin",["dojo/_base/kernel","dojo/_base/declare","dojo/_base/lang","dojo/_base/Deferred","dojo/on"],function(h,n,f,k,o){function l(a){o.emit(this.domNode,"dgrid-error",{error:a,cancelable:!0,bubbles:!0})}return n(null,{store:null,query:null,queryOptions:null,getBeforePut:!0,noDataMessage:"",loadingMessage:"",constructor:function(){this.query={};this.queryOptions={};this.dirty={};this._updating={}},_configColumn:function(a){if(a.set){if(!this._columnsWithSet)this._columnsWithSet=
{};this._columnsWithSet[a.field]=a}},_configColumns:function(){this._columnsWithSet=null;return this.inherited(arguments)},_setStore:function(a,b,c){this.store=a;this.dirty={};this.set("query",b,c)},_setQuery:function(a,b){var c=b&&b.sort;this.query=void 0!==a?a:this.query;this.queryOptions=b||this.queryOptions;c?this.sort(c):this.refresh()},setStore:function(a,b,c){h.deprecated("setStore(...)",'use set("store", ...) instead',"dgrid 1.0");this.set("store",a,b,c)},setQuery:function(a,b){h.deprecated("setQuery(...)",
'use set("query", ...) instead',"dgrid 1.0");this.set("query",a,b)},_getQueryOptions:function(){var a=f.delegate(this.queryOptions,{});if(this._sort.length)a.sort=this._sort;return a},_getQuery:function(){var a=this.query;return"object"==typeof a&&null!=a?f.delegate(a,{}):a},_setSort:function(a,b){if(this.store)this._lastCollection=null;this.inherited(arguments)},insertRow:function(a,b,c,i,g){var d=this.store,m=this.dirty,d=d&&d.getIdentity(a),e;d in m&&!(d in this._updating)&&(e=m[d]);e&&(a=f.delegate(a,
e));return this.inherited(arguments)},updateDirty:function(a,b,c){var i=this.dirty,g=i[a];g||(g=i[a]={});g[b]=c},setDirty:function(a,b,c){h.deprecated("setDirty(...)","use updateDirty() instead","dgrid 1.0");this.updateDirty(a,b,c)},save:function(){function a(a,d){return function(e){var f=b._columnsWithSet,g=b._updating,j,h;for(j in d)e[j]=d[j];if(f)for(j in f)h=f[j].set(e),void 0!==h&&(e[j]=h);g[a]=!0;return k.when(c.put(e),function(){delete i[a];delete g[a]})}}var b=this,c=this.store,i=this.dirty,
g=new k,d=g.promise,f=function(a){var d;return b.getBeforePut||!(d=b.row(a).data)?function(){return c.get(a)}:function(){return d}},e;for(e in i)var h=a(e,i[e]),d=d.then(f(e)).then(h);g.resolve();return d},revert:function(){this.dirty={};this.refresh()},_trackError:function(a){var b;"string"==typeof a&&(a=f.hitch(this,a));try{b=a()}catch(c){l.call(this,c)}return k.when(b,null,f.hitch(this,l))}})});